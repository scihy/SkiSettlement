@inherits LayoutComponentBase
@inject IHttpContextAccessor HttpContextAccessor

<MudThemeProvider Theme="_theme" IsDarkMode="_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />

<MudLayout Class="@(_isDarkMode ? "app-dark" : "app-light")">
    <MudAppBar Elevation="0" Class="ski-appbar apple-appbar" Dense="true">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" Href="#" />
        <MudText Typo="Typo.h6" Class="ml-3 apple-heading">SkiSettlement</MudText>
        <MudSpacer />
        <a href="javascript:void(0)" class="theme-toggle-link" onclick="window.toggleTheme(); return false;" title="@(_isDarkMode ? "Jasny motyw" : "Ciemny motyw")" aria-label="@(_isDarkMode ? "Jasny motyw" : "Ciemny motyw")">
            @if (_isDarkMode)
            {
                <span class="theme-icon">â˜€</span>
            }
            else
            {
                <span class="theme-icon">ðŸŒ™</span>
            }
        </a>
    </MudAppBar>
    <MudDrawer Open="true" ClipMode="DrawerClipMode.Always" Elevation="0" Class="ski-drawer apple-drawer">
        <MudNavMenu Class="ski-nav-menu">
            <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Wyjazdy</MudNavLink>
            <MudNavLink Href="/dodaj-wyjazd" Icon="@Icons.Material.Filled.Add">Dodaj wyjazd</MudNavLink>
            <MudNavLink Href="/slownik" Icon="@Icons.Material.Filled.MenuBook">SÅ‚ownik</MudNavLink>
            <MudNavLink Href="/rozliczenia-instruktorow" Icon="@Icons.Material.Filled.People">Rozliczenia instruktorÃ³w</MudNavLink>
        </MudNavMenu>
    </MudDrawer>
    <MudMainContent Class="ski-main">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="py-4">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

<MudSnackbarProvider />

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
</div>

@code {
    private bool _isDarkMode = true;
    private MudTheme _theme = new();

    protected override void OnInitialized()
    {
        var theme = HttpContextAccessor.HttpContext?.Request.Cookies["theme"];
        _isDarkMode = (theme != "light");
    }
}
