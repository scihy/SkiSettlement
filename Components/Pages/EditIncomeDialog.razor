@rendermode InteractiveServer
@inject IIncomeService IncomeService

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">Edytuj przychód</MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="3">
            <MudTextField @bind-Value="_model.Description" Label="Opis" Variant="Variant.Outlined" />
            <MudNumericField @bind-Value="_model.Amount" Label="Kwota" Variant="Variant.Outlined" Min="0" Step="0.01m" />
            <MudSelect T="bool" @bind-Value="_model.IsPaid" Label="Płatność" Variant="Variant.Outlined" Dense="true">
                <MudSelectItem T="bool" Value="true"><MudText Style="font-weight: 600;" Color="Color.Success">Tak</MudText></MudSelectItem>
                <MudSelectItem T="bool" Value="false"><MudText Style="font-weight: 600;" Color="Color.Error">Nie</MudText></MudSelectItem>
            </MudSelect>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Anuluj</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save">Zapisz</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public Income Income { get; set; } = null!;

    private Income _model = new();

    protected override void OnParametersSet()
    {
        _model = new Income
        {
            Id = Income.Id,
            TripId = Income.TripId,
            Description = Income.Description,
            Amount = Income.Amount,
            IsPaid = Income.IsPaid
        };
    }

    private void Cancel() => MudDialog.Cancel();

    private async Task Save()
    {
        if (string.IsNullOrWhiteSpace(_model.Description)) return;
        await IncomeService.UpdateAsync(_model);
        MudDialog.Close(DialogResult.Ok(true));
    }
}
